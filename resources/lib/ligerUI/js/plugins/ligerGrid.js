/**
* jQuery ligerUI 1.1.9
* 
* http://ligerui.com
*  
* Author daomi 2012 [ gd_star@163.com ] 
* 
*/(function($){var l=$.ligerui;$.fn.ligerGrid=function(a){return $.ligerui.run.call(this,"ligerGrid",arguments)},$.fn.ligerGetGridManager=function(){return $.ligerui.run.call(this,"ligerGetGridManager",arguments)},$.ligerDefaults.Grid={title:null,width:"auto",height:"auto",columnWidth:null,resizable:!0,url:!1,usePager:!0,page:1,pageSize:10,pageSizeOptions:[10,20,30,40,50],parms:[],columns:[],minColToggle:1,dataType:"server",dataAction:"server",showTableToggleBtn:!1,switchPageSizeApplyComboBox:!1,allowAdjustColWidth:!0,checkbox:!1,allowHideColumn:!0,enabledEdit:!1,isScroll:!0,onDragCol:null,onToggleCol:null,onChangeSort:null,onSuccess:null,onDblClickRow:null,onSelectRow:null,onUnSelectRow:null,onBeforeCheckRow:null,onCheckRow:null,onBeforeCheckAllRow:null,onCheckAllRow:null,onBeforeShowData:null,onAfterShowData:null,onError:null,onSubmit:null,dateFormat:"yyyy-MM-dd",InWindow:!0,statusName:"__status",method:"post",async:!0,fixedCellHeight:!0,heightDiff:0,cssClass:null,root:"Rows",record:"Total",pageParmName:"page",pagesizeParmName:"pagesize",sortnameParmName:"sortname",sortorderParmName:"sortorder",onReload:null,onToFirst:null,onToPrev:null,onToNext:null,onToLast:null,allowUnSelectRow:!1,alternatingRow:!0,mouseoverRowCssClass:"l-grid-row-over",enabledSort:!0,rowAttrRender:null,groupColumnName:null,groupColumnDisplay:"分组",groupRender:null,totalRender:null,delayLoad:!1,where:null,selectRowButtonOnly:!1,onAfterAddRow:null,onBeforeEdit:null,onBeforeSubmitEdit:null,onAfterEdit:null,onLoading:null,onLoaded:null,onContextmenu:null,whenRClickToSelect:!1,contentType:null,checkboxColWidth:27,detailColWidth:29,clickToEdit:!0,detailToEdit:!1,onEndEdit:null,minColumnWidth:80,tree:null,isChecked:null,frozen:!0,frozenDetail:!1,frozenCheckbox:!0,detailHeight:260,rownumbers:!1,frozenRownumbers:!0,rownumbersColWidth:26,colDraggable:!1,rowDraggable:!1,rowDraggingRender:null,autoCheckChildren:!0,onRowDragDrop:null,rowHeight:22,headerRowHeight:23,toolbar:null,headerImg:null},$.ligerDefaults.GridString={errorMessage:"发生错误",pageStatMessage:"显示从{from}到{to}，总 {total} 条 。每页显示：{pagesize}",pageTextMessage:"Page",loadingMessage:"加载中...",findTextMessage:"查找",noRecordMessage:"没有符合条件的记录存在",isContinueByDataChanged:"数据已经改变,如果继续将丢失数据,是否继续?",cancelMessage:"取消",saveMessage:"保存",applyMessage:"应用",draggingMessage:"{count}行"},$.ligerMethos.Grid=$.ligerMethos.Grid||{},$.ligerDefaults.Grid.sorters=$.ligerDefaults.Grid.sorters||{},$.ligerDefaults.Grid.formatters=$.ligerDefaults.Grid.formatters||{},$.ligerDefaults.Grid.editors=$.ligerDefaults.Grid.editors||{},$.ligerDefaults.Grid.sorters.date=function(a,b){return a<b?-1:a>b?1:0},$.ligerDefaults.Grid.sorters["int"]=function(a,b){return parseInt(a)<parseInt(b)?-1:parseInt(a)>parseInt(b)?1:0},$.ligerDefaults.Grid.sorters["float"]=function(a,b){return parseFloat(a)<parseFloat(b)?-1:parseFloat(a)>parseFloat(b)?1:0},$.ligerDefaults.Grid.sorters.string=function(a,b){return a.localeCompare(b)},$.ligerDefaults.Grid.formatters.date=function(value,column){function getFormatDate(a,b){var c=this,d=this.options;if(isNaN(a))return null;var e=b,f={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var g in f)(new RegExp("("+g+")")).test(e)&&(e=e.replace(RegExp.$1,RegExp.$1.length==1?f[g]:("00"+f[g]).substr((""+f[g]).length)));return e}if(!value)return"";typeof value=="string"&&/^\/Date/.test(value)&&(value=value.replace(/^\//,"new ").replace(/\/$/,""),eval("value = "+value));if(value instanceof Date){var format=column.format||this.options.dateFormat||"yyyy-MM-dd";return getFormatDate(value,format)}return value.toString()},$.ligerDefaults.Grid.editors.date={create:function(a,b){var c=b.column,d=$("<input type='text'/>");a.append(d);var e={},f=c.editor.p||c.editor.ext;if(f){var g=typeof f=="function"?f(b.record,b.rowindex,b.value,c):f;$.extend(e,g)}d.ligerDateEditor(e);return d},getValue:function(a,b){return a.liger("option","value")},setValue:function(a,b,c){a.liger("option","value",b)},resize:function(a,b,c,d){a.liger("option","width",b),a.liger("option","height",c)},destroy:function(a,b){a.liger("destroy")}},$.ligerDefaults.Grid.editors.select=$.ligerDefaults.Grid.editors.combobox={create:function(a,b){var c=b.column,d=$("<input type='text'/>");a.append(d);var e={data:c.editor.data,slide:!1,valueField:c.editor.valueField||c.editor.valueColumnName,textField:c.editor.textField||c.editor.displayColumnName},f=c.editor.p||c.editor.ext;if(f){var g=typeof f=="function"?f(b.record,b.rowindex,b.value,c):f;$.extend(e,g)}d.ligerComboBox(e);return d},getValue:function(a,b){return a.liger("option","value")},setValue:function(a,b,c){a.liger("option","value",b)},resize:function(a,b,c,d){a.liger("option","width",b),a.liger("option","height",c)},destroy:function(a,b){a.liger("destroy")}},$.ligerDefaults.Grid.editors["int"]=$.ligerDefaults.Grid.editors["float"]=$.ligerDefaults.Grid.editors.spinner={create:function(a,b){var c=b.column,d=$("<input type='text'/>");a.append(d),d.css({border:"#6E90BE"});var e={type:c.editor.type=="float"?"float":"int"};c.editor.minValue!=undefined&&(e.minValue=c.editor.minValue),c.editor.maxValue!=undefined&&(e.maxValue=c.editor.maxValue),d.ligerSpinner(e);return d},getValue:function(a,b){var c=b.column,d=c.editor.type=="int";return d?parseInt(a.val(),10):parseFloat(a.val())},setValue:function(a,b,c){a.val(b)},resize:function(a,b,c,d){a.liger("option","width",b),a.liger("option","height",c)},destroy:function(a,b){a.liger("destroy")}},$.ligerDefaults.Grid.editors.string=$.ligerDefaults.Grid.editors.text={create:function(a,b){var c=$("<input type='text' class='l-text-editing'/>");a.append(c),c.ligerTextBox();return c},getValue:function(a,b){return a.val()},setValue:function(a,b,c){a.val(b)},resize:function(a,b,c,d){a.liger("option","width",b),a.liger("option","height",c)},destroy:function(a,b){a.liger("destroy")}},$.ligerDefaults.Grid.editors.chk=$.ligerDefaults.Grid.editors.checkbox={create:function(a,b){var c=$("<input type='checkbox' />");a.append(c),c.ligerCheckBox();return c},getValue:function(a,b){return a[0].checked?1:0},setValue:function(a,b,c){a.val(b?!0:!1)},resize:function(a,b,c,d){a.liger("option","width",b),a.liger("option","height",c)},destroy:function(a,b){a.liger("destroy")}},$.ligerui.controls.Grid=function(a,b){$.ligerui.controls.Grid.base.constructor.call(this,a,b)},$.ligerui.controls.Grid.ligerExtend($.ligerui.core.UIComponent,{__getType:function(){return"$.ligerui.controls.Grid"},__idPrev:function(){return"grid"},_extendMethods:function(){return $.ligerMethos.Grid},_init:function(){$.ligerui.controls.Grid.base._init.call(this);var a=this,b=this.options;b.dataType=b.url?"server":"local",b.dataType=="local"&&(b.data=b.data||[],b.dataAction="local"),b.isScroll==!1&&(b.height="auto"),b.frozen||(b.frozenCheckbox=!1,b.frozenDetail=!1,b.frozenRownumbers=!1),b.detailToEdit&&(b.enabledEdit=!0,b.clickToEdit=!1,b.detail={height:"auto",onShowDetail:function(c,d,e){function f(){$(d).parent().parent().remove(),a.collapseDetail(c)}$(d).addClass("l-grid-detailpanel-edit"),a.beginEdit(c,function(a,c){var e=$("<div class='l-editbox'></div>");e.width(120).height(b.rowHeight+1),e.appendTo(d);return e}),$("<div class='l-clear'></div>").appendTo(d),$("<div class='l-button'>"+b.saveMessage+"</div>").appendTo(d).click(function(){a.endEdit(c),f()}),$("<div class='l-button'>"+b.applyMessage+"</div>").appendTo(d).click(function(){a.submitEdit(c)}),$("<div class='l-button'>"+b.cancelMessage+"</div>").appendTo(d).click(function(){a.cancelEdit(c),f()})}}),b.tree&&(b.tree.childrenName=b.tree.childrenName||"children",b.tree.isParent=b.tree.isParent||function(a){var c=b.tree.childrenName in a;return c},b.tree.isExtend=b.tree.isExtend||function(a){if("isextend"in a&&a.isextend==!1)return!1;return!0})},_render:function(){var a=this,b=this.options;a.grid=$(a.element),a.grid.addClass("l-panel");var c=[];c.push("        <div class='l-panel-header'><span class='l-panel-header-text'></span></div>"),c.push("                    <div class='l-grid-loading'></div>"),c.push("        <div class='l-panel-topbar'></div>"),c.push("        <div class='l-panel-bwarp'>"),c.push("            <div class='l-panel-body'>"),c.push("                <div class='l-grid'>"),c.push("                    <div class='l-grid-dragging-line'></div>"),c.push("                    <div class='l-grid-popup'><table cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),c.push("                  <div class='l-grid1'>"),c.push("                      <div class='l-grid-header l-grid-header1'>"),c.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),c.push("                      </div>"),c.push("                      <div class='l-grid-body l-grid-body1'>"),c.push("                      </div>"),c.push("                  </div>"),c.push("                  <div class='l-grid2'>"),c.push("                      <div class='l-grid-header l-grid-header2'>"),c.push("                          <div class='l-grid-header-inner'><table class='l-grid-header-table' cellpadding='0' cellspacing='0'><tbody></tbody></table></div>"),c.push("                      </div>"),c.push("                      <div class='l-grid-body l-grid-body2 l-scroll'>"),c.push("                      </div>"),c.push("                  </div>"),c.push("                 </div>"),c.push("              </div>"),c.push("         </div>"),c.push("         <div class='l-panel-bar'>"),c.push("            <div class='l-panel-bbar-inner'>"),c.push("                <div class='l-bar-group  l-bar-message'><span class='l-bar-text'></span></div>"),c.push("            <div class='l-bar-group l-bar-selectpagesize'></div>"),c.push("                <div class='l-bar-separator'></div>"),c.push("                <div class='l-bar-group'>"),c.push("                    <div class='l-bar-button l-bar-btnfirst'><span></span></div>"),c.push("                    <div class='l-bar-button l-bar-btnprev'><span></span></div>"),c.push("                </div>"),c.push("                <div class='l-bar-separator'></div>"),c.push("                <div class='l-bar-group'><span class='pcontrol'> <input type='text' size='4' value='1' style='width:20px' maxlength='3' /> / <span></span></span></div>"),c.push("                <div class='l-bar-separator'></div>"),c.push("                <div class='l-bar-group'>"),c.push("                     <div class='l-bar-button l-bar-btnnext'><span></span></div>"),c.push("                    <div class='l-bar-button l-bar-btnlast'><span></span></div>"),c.push("                </div>"),c.push("                <div class='l-bar-separator'></div>"),c.push("                <div class='l-bar-group'>"),c.push("                     <div class='l-bar-button l-bar-btnload'><span></span></div>"),c.push("                </div>"),c.push("                <div class='l-bar-separator'></div>"),c.push("                <div class='l-clear'></div>"),c.push("            </div>"),c.push("         </div>"),a.grid.html(c.join("")),a.header=$(".l-panel-header:first",a.grid),a.body=$(".l-panel-body:first",a.grid),a.toolbar=$(".l-panel-bar:first",a.grid),a.popup=$(".l-grid-popup:first",a.grid),a.gridloading=$(".l-grid-loading:first",a.grid),a.draggingline=$(".l-grid-dragging-line",a.grid),a.topbar=$(".l-panel-topbar:first",a.grid),a.gridview=$(".l-grid:first",a.grid),a.gridview.attr("id",a.id+"grid"),a.gridview1=$(".l-grid1:first",a.gridview),a.gridview2=$(".l-grid2:first",a.gridview),a.gridheader=$(".l-grid-header:first",a.gridview2),a.gridbody=$(".l-grid-body:first",a.gridview2),a.f={},a.f.gridheader=$(".l-grid-header:first",a.gridview1),a.f.gridbody=$(".l-grid-body:first",a.gridview1),a.currentData=null,a.changedCells={},a.editors={},a.editor={editing:!1},b.height=="auto"&&a.bind("SysGridHeightChanged",function(){a.enabledFrozen()&&a.gridview.height(Math.max(a.gridview1.height(),a.gridview2.height()))});var d=$.extend({},b);this._bulid(),this._setColumns(b.columns),delete d.columns,delete d.data,delete d.url,a.set(d),b.delayLoad||(b.url?a.set({url:b.url}):b.data&&a.set({data:b.data}))},_setFrozen:function(a){a?this.grid.addClass("l-frozen"):this.grid.removeClass("l-frozen")},_setCssClass:function(a){this.grid.addClass(a)},_setLoadingMessage:function(a){this.gridloading.html(a)},_setHeight:function(a){var b=this,c=this.options;b.unbind("SysGridHeightChanged");if(a=="auto")b.bind("SysGridHeightChanged",function(){b.enabledFrozen()&&b.gridview.height(Math.max(b.gridview1.height(),b.gridview2.height()))});else{typeof a=="string"&&a.indexOf("%")>0&&(c.inWindow?a=$(window).height()*parseFloat(a)*.01:a=b.grid.parent().height()*parseFloat(a)*.01),c.title&&(a-=24),c.usePager&&(a-=32),c.totalRender&&(a-=25),c.toolbar&&(a-=b.topbar.outerHeight());var d=c.headerRowHeight*(b._columnMaxLevel-1)+c.headerRowHeight-1;a-=d,a>0&&(b.gridbody.height(a),a>18&&b.f.gridbody.height(a-18),b.gridview.height(a+d))}},_updateFrozenWidth:function(){var a=this,b=this.options;if(a.enabledFrozen()){a.gridview1.width(a.f.gridtablewidth);var c=a.gridview.width()-a.f.gridtablewidth;a.gridview2.css({left:a.f.gridtablewidth}),c>0&&a.gridview2.css({width:c})}},_setWidth:function(a){var b=this,c=this.options;b.enabledFrozen()&&b._onResize()},_setUrl:function(a){this.options.url=a,a?(this.options.dataType="server",this.loadData(!0)):this.options.dataType="local"},_setData:function(a){this.loadData(this.options.data)},loadData:function(a){var b=this,c=this.options;b.loading=!0;var d=null,e=!0;typeof a=="function"?(d=a,e=!1):typeof a=="boolean"?e=a:typeof a=="object"&&a&&(e=!1,c.dataType="local",c.data=a),c.newPage||(c.newPage=1),c.dataAction=="server"&&(c.sortOrder||(c.sortOrder="asc"));var f=[];if(c.parms)if(c.parms.length)$(c.parms).each(function(){f.push({name:this.name,value:this.value})});else if(typeof c.parms=="object")for(var g in c.parms)f.push({name:g,value:c.parms[g]});c.dataAction=="server"&&(c.usePager&&(f.push({name:c.pageParmName,value:c.newPage}),f.push({name:c.pagesizeParmName,value:c.pageSize})),c.sortName&&(f.push({name:c.sortnameParmName,value:c.sortName}),f.push({name:c.sortorderParmName,value:c.sortOrder}))),$(".l-bar-btnload span",b.toolbar).addClass("l-disabled"),c.dataType=="local"?(b.filteredData=b.data=c.data,d&&(b.filteredData[c.root]=b._searchData(b.filteredData[c.root],d)),c.usePager?b.currentData=b._getCurrentPageData(b.filteredData):b.currentData=b.filteredData,b._showData()):c.dataAction=="local"&&!e?b.data&&b.data[c.root]&&(b.filteredData=b.data,d&&(b.filteredData[c.root]=b._searchData(b.filteredData[c.root],d)),b.currentData=b._getCurrentPageData(b.filteredData),b._showData()):b.loadServerData(f,d),b.loading=!1},loadServerData:function(a,b){var c=this,d=this.options,e={type:d.method,url:d.url,data:a,async:d.async,dataType:"json",beforeSend:function(){c.hasBind("loading")?c.trigger("loading"):c.toggleLoading(!0)},success:function(a){c.trigger("success",[a,c]);!a||!a[d.root]||!a[d.root].length?(c.currentData=c.data={},c.currentData[d.root]=c.data[d.root]=[],c.currentData[d.record]=c.data[d.record]=0,c._showData()):(c.data=a,d.dataAction=="server"?c.currentData=c.data:(c.filteredData=c.data,b&&(c.filteredData[d.root]=c._searchData(c.filteredData[d.root],b)),d.usePager?c.currentData=c._getCurrentPageData(c.filteredData):c.currentData=c.filteredData),c._showData.ligerDefer(c,10,[c.currentData]))},complete:function(){c.trigger("complete",[c]),c.hasBind("loaded")?c.trigger("loaded",[c]):c.toggleLoading.ligerDefer(c,10,[!1])},error:function(a,b,e){c.currentData=c.data={},c.currentData[d.root]=c.data[d.root]=[],c.currentData[d.record]=c.data[d.record]=0,c.toggleLoading.ligerDefer(c,10,[!1]),$(".l-bar-btnload span",c.toolbar).removeClass("l-disabled"),c.trigger("error",[a,b,e])}};d.contentType&&(e.contentType=d.contentType),$.ajax(e)},toggleLoading:function(a){this.gridloading[a?"show":"hide"]()},_createEditor:function(a,b,c,d,e){var f=a.create(b,c);a.setValue&&a.setValue(f,c.value,c),a.resize&&a.resize(f,d,e,c);return f},beginEdit:function(a,b){var c=this,d=this.options;if(!!d.enabledEdit&&!d.clickToEdit){var e=c.getRow(a);if(e._editing)return;if(c.trigger("beginEdit",{record:e,rowindex:e.__index})==!1)return;c.editors[e.__id]={},e._editing=!0,c.reRender({rowdata:e}),b=b||function(a,b){var d=c.getCellObj(a,b),e=$(d).html("");c.setCellEditing(a,b,!0);return e};for(var f=0,g=c.columns.length;f<g;f++){var h=c.columns[f];if(!h.name||!h.editor||!h.editor.type||!d.editors[h.editor.type])continue;var i=d.editors[h.editor.type],j={record:e,value:e[h.name],column:h,rowindex:e.__index,grid:c},k=b(e,h),l=k.width(),m=k.height(),n=c._createEditor(i,k,j,l,m);c.editors[e.__id][h.__id]={editor:i,input:n,editParm:j,container:k}}c.trigger("afterBeginEdit",{record:e,rowindex:e.__index})}},cancelEdit:function(a){var b=this;if(a==undefined)for(var c in b.editors)b.cancelEdit(c);else{var d=b.getRow(a);if(!b.editors[d.__id])return;if(b.trigger("cancelEdit",{record:d,rowindex:d.__index})==!1)return;for(var e in b.editors[d.__id]){var f=b.editors[d.__id][e];f.editor.destroy&&f.editor.destroy(f.input,f.editParm)}delete b.editors[d.__id],delete d._editing,b.reRender({rowdata:d})}},addEditRow:function(a){this.submitEdit(),a=this.add(a),this.beginEdit(a)},submitEdit:function(a){var b=this,c=this.options;if(a==undefined)for(var d in b.editors)b.submitEdit(d);else{var e=b.getRow(a),f={};if(!b.editors[e.__id])return;for(var g in b.editors[e.__id]){var h=b.editors[e.__id][g],i=h.editParm.column;i.name&&(f[i.name]=h.editor.getValue(h.input,h.editParm))}if(b.trigger("beforeSubmitEdit",{record:e,rowindex:e.__index,newdata:f})==!1)return!1;b.updateRow(e,f),b.trigger("afterSubmitEdit",{record:e,rowindex:e.__index,newdata:f})}},endEdit:function(a){var b=this,c=this.options;if(b.editor.editing){var d=b.editor;b.trigger("sysEndEdit",[b.editor.editParm]),b.trigger("endEdit",[b.editor.editParm]),d.editor.destroy&&d.editor.destroy(d.input,d.editParm),b.editor.container.remove(),b.reRender({rowdata:b.editor.editParm.record,column:b.editor.editParm.column}),b.trigger("afterEdit",[b.editor.editParm]),b.editor={editing:!1}}else if(a!=undefined){var e=b.getRow(a);if(!b.editors[e.__id])return;if(b.submitEdit(a)==!1)return!1;for(var f in b.editors[e.__id]){var d=b.editors[e.__id][f];d.editor.destroy&&d.editor.destroy(d.input,d.editParm)}delete b.editors[e.__id],delete e._editing,b.trigger("afterEdit",{record:e,rowindex:e.__index})}else for(var g in b.editors)b.endEdit(g)},setWidth:function(a){return this._setWidth(a)},setHeight:function(a){return this._setHeight(a)},enabledCheckbox:function(){return this.options.checkbox?!0:!1},enabledFrozen:function(){var a=this,b=this.options;if(!b.frozen)return!1;var c=a.columns||[];if(a.enabledDetail()&&b.frozenDetail||a.enabledCheckbox()&&b.frozenCheckbox||b.frozenRownumbers&&b.rownumbers)return!0;for(var d=0,e=c.length;d<e;d++)if(c[d].frozen)return!0;this._setFrozen(!1);return!1},enabledDetailEdit:function(){if(!this.enabledDetail())return!1;return this.options.detailToEdit?!0:!1},enabledDetail:function(){if(this.options.detail&&this.options.detail.onShowDetail)return!0;return!1},enabledGroup:function(){return this.options.groupColumnName?!0:!1},deleteSelectedRow:function(){if(!!this.selected){for(var a in this.selected){var b=this.selected[a];b.__id in this.records&&this._deleteData.ligerDefer(this,10,[b])}this.reRender.ligerDefer(this,20)}},removeRange:function(a){var b=this,c=this.options;$.each(a,function(){b._removeData(this)}),b.reRender()},remove:function(a){var b=this,c=this.options,d=b.getRow(a);b._removeData(a),b.reRender()},deleteRange:function(a){var b=this,c=this.options;$.each(a,function(){b._deleteData(this)}),b.reRender()},deleteRow:function(a){var b=this,c=this.options,d=b.getRow(a);!d||(b._deleteData(d),b.reRender(),b.isDataChanged=!0)},_deleteData:function(a){var b=this,c=this.options,d=b.getRow(a);d[c.statusName]="delete";if(c.tree){var e=b.getChildren(d,!0);if(e)for(var f=0,g=e.length;f<g;f++)e[f][c.statusName]="delete"}b.deletedRows=b.deletedRows||[],b.deletedRows.push(d),b._removeSelected(d)},updateCell:function(a,b,c){var d=this,e=this.options,f,g,h;if(typeof a=="string")for(var i=0,j=d.columns.length;i<j;i++)d.columns[i].name==a&&d.updateCell(i,b,c);else{if(typeof a=="number")f=d.columns[a],h=d.getRow(c),g=d.getCellObj(h,f);else if(typeof a=="object"&&a.__id)f=a,h=d.getRow(c),g=d.getCellObj(h,f);else{g=a;var k=g.id.split("|"),l=k[k.length-1];f=d._columns[l];var m=$(g).parent();h=h||d.getRow(m[0])}b!=null&&f.name&&(h[f.name]=b,h[e.statusName]!="add"&&(h[e.statusName]="update"),d.isDataChanged=!0),d.reRender({rowdata:h,column:f})}},addRows:function(a,b,c,d){var e=this,f=this.options;$(a).each(function(){e.addRow(this,b,c,d)})},_createRowid:function(){return"r"+(1e3+this.recordNumber)},_isRowId:function(a){return a in this.records},_addNewRecord:function(a,b,c){var d=this,e=this.options;d.recordNumber++,a.__id=d._createRowid(),a.__previd=b;if(b&&b!=-1){var f=d.records[b];if(f.__nextid&&f.__nextid!=-1){var g=d.records[f.__nextid];g&&(g.__previd=a.__id)}f.__nextid=a.__id,a.__index=f.__index+1}else a.__index=0;if(e.tree){if(c&&c!=-1){var h=d.records[c];a.__pid=c,a.__level=h.__level+1}else a.__pid=-1,a.__level=1;a.__hasChildren=a[e.tree.childrenName]?!0:!1}a[e.statusName]!="add"&&(a[e.statusName]="nochanged"),d.rows[a.__index]=a,d.records[a.__id]=a;return a},_getRows:function(a){function e(a){if(!!a&&!!a.length)for(var b=0,f=a.length;b<f;b++){var g=a[b];d.push(g),g[c.tree.childrenName]&&e(g[c.tree.childrenName])}}var b=this,c=this.options,d=[];e(a);return d},_updateGridData:function(){function d(e,f){if(!!e&&!!e.length)for(var h=0,i=e.length;h<i;h++){var j=e[h];a.formatRecord(j);if(j[b.statusName]=="delete")continue;a._addNewRecord(j,c,f),c=j.__id,j.__hasChildren&&d(j[b.tree.childrenName],j.__id)}}var a=this,b=this.options;a.recordNumber=0,a.rows=[],a.records={};var c=-1;d(a.currentData[b.root],-1);return a.rows},_moveData:function(a,b,c){var d=this,e=this.options,f=d.getRow(a),g=d.getRow(b),h,i,j=d._getParentChildren(f);h=$.inArray(f,j),j.splice(h,1),j=d._getParentChildren(g),i=$.inArray(g,j),j.splice(i+(c?1:0),0,f)},move:function(a,b,c){this._moveData(a,b,c),this.reRender()},moveRange:function(a,b,c){for(var d in a)this._moveData(a[d],b,c);this.reRender()},up:function(a){var b=this,c=this.options,d=b.getRow(a),e=b._getParentChildren(d),f=$.inArray(d,e);if(f!=-1&&f!=0){var g=b.getSelected();b.move(d,e[f-1],!1),b.select(g)}},down:function(a){var b=this,c=this.options,d=b.getRow(a),e=b._getParentChildren(d),f=$.inArray(d,e);if(f!=-1&&f!=e.length-1){var g=b.getSelected();b.move(d,e[f+1],!0),b.select(g)}},addRow:function(a,b,c,d){var e=this,f=this.options;a=a||{},e._addData(a,d,b,c),e.reRender(),a[f.statusName]="add";if(f.tree){var g=e.getChildren(a,!0);if(g)for(var h=0,i=g.length;h<i;h++)g[h][f.statusName]="add"}e.isDataChanged=!0,f.total=f.total?f.total+1:1,f.pageCount=Math.ceil(f.total/f.pageSize),e._buildPager(),e.trigger("SysGridHeightChanged"),e.trigger("afterAddRow",[a]);return a},updateRow:function(a,b){var c=this,d=this.options,e=c.getRow(a);c.isDataChanged=!0,$.extend(e,b||{}),e[d.statusName]!="add"&&(e[d.statusName]="update"),c.reRender.ligerDefer(c,10,[{rowdata:e}]);return e},setCellEditing:function(a,b,c){var d=this,e=this.options,f=d.getCellObj(a,b),g=c?"addClass":"removeClass";$(f)[g]("l-grid-row-cell-editing");if(a.__id!=0){var h=$(d.getRowObj(a.__id)).prev();if(!h.length)return;var i=d.getRow(h[0]),j=d.getCellObj(i,b);if(!j)return;$(j)[g]("l-grid-row-cell-editing-topcell")}if(b.__previd!=-1&&b.__previd!=null){var j=$(d.getCellObj(a,b)).prev();$(j)[g]("l-grid-row-cell-editing-leftcell")}},reRender:function(a){var b=this,c=this.options;a=a||{};var d=a.rowdata,e=a.column;if(!e||!e.isdetail&&!e.ischeckbox){if(d&&d[c.statusName]=="delete")return;if(d&&e){var f=b.getCellObj(d,e);$(f).html(b._getCellHtml(d,e)),e.issystem||b.setCellEditing(d,e,!1)}else if(d)$(b.columns).each(function(){b.reRender({rowdata:d,column:this})});else if(e){for(var g in b.records)b.reRender({rowdata:b.records[g],column:e});for(var h=0;h<b.totalNumber;h++){var i=document.getElementById(b.id+"|total"+h+"|"+e.__id);$("div:first",i).html(b._getTotalCellContent(e,b.groups&&b.groups[h]?b.groups[h]:b.currentData[c.root]))}}else b._showData()}},getData:function(a,b){var c=this,d=this.options,e=[];for(var f in c.records){var g=$.extend(!0,{},c.records[f]);(g[d.statusName]==a||a==undefined)&&e.push(c.formatRecord(g,b))}return e},formatRecord:function(a,b){delete a.__id,delete a.__previd,delete a.__nextid,delete a.__index,this.options.tree&&(delete a.__pid,delete a.__level,delete a.__hasChildren),b&&delete a[this.options.statusName];return a},getUpdated:function(){return this.getData("update",!0)},getDeleted:function(){return this.deletedRows},getAdded:function(){return this.getData("add",!0)},getColumn:function(a){var b=this,c=this.options;if(typeof a=="string")return b._isColumnId(a)?b._columns[a]:b.columns[parseInt(a)];if(typeof a=="number")return b.columns[a];if(typeof a=="object"&&a.nodeType==1){var d=a.id.split("|"),e=d[d.length-1];return b._columns[e]}return a},getColumnType:function(a){var b=this,c=this.options;for(i=0;i<b.columns.length;i++)if(b.columns[i].name==a){if(b.columns[i].type)return b.columns[i].type;return"string"}return null},isTotalSummary:function(){var a=this,b=this.options;for(var c=0;c<a.columns.length;c++)if(a.columns[c].totalSummary)return!0;return!1},getColumns:function(a){var b=this,c=this.options,d=[];for(var e in b._columns){var f=b._columns[e];a!=undefined?f.__level==a&&d.push(f):f.__leaf&&d.push(f)}return d},changeSort:function(a,b){var c=this,d=this.options;if(c.loading)return!0;if(d.dataAction=="local"){var e=c.getColumnType(a);c.sortedData||(c.sortedData=c.filteredData),d.sortName==a?c.sortedData[d.root].reverse():c.sortedData[d.root].sort(function(b,d){return c._compareData(b,d,a,e)}),d.usePager?c.currentData=c._getCurrentPageData(c.sortedData):c.currentData=c.sortedData,c._showData()}d.sortName=a,d.sortOrder=b,d.dataAction=="server"&&c.loadData(d.where)},changePage:function(a){var b=this,c=this.options;if(b.loading)return!0;if(c.dataAction!="local"&&b.isDataChanged&&!confirm(c.isContinueByDataChanged))return!1;c.pageCount=parseInt($(".pcontrol span",b.toolbar).html());switch(a){case"first":if(c.page==1)return;c.newPage=1;break;case"prev":if(c.page==1)return;c.page>1&&(c.newPage=parseInt(c.page)-1);break;case"next":if(c.page>=c.pageCount)return;c.newPage=parseInt(c.page)+1;break;case"last":if(c.page>=c.pageCount)return;c.newPage=c.pageCount;break;case"input":var d=parseInt($(".pcontrol input",b.toolbar).val());isNaN(d)&&(d=1),d<1?d=1:d>c.pageCount&&(d=c.pageCount),$(".pcontrol input",b.toolbar).val(d),c.newPage=d}if(c.newPage==c.page)return!1;c.newPage==1?($(".l-bar-btnfirst span",b.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",b.toolbar).addClass("l-disabled")):($(".l-bar-btnfirst span",b.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",b.toolbar).removeClass("l-disabled")),c.newPage==c.pageCount?($(".l-bar-btnlast span",b.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",b.toolbar).addClass("l-disabled")):($(".l-bar-btnlast span",b.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",b.toolbar).removeClass("l-disabled")),b.trigger("changePage",[c.newPage]),c.dataAction=="server"?b.loadData(c.where):(b.currentData=b._getCurrentPageData(b.filteredData),b._showData())},getSelectedRow:function(){for(var a in this.selected){var b=this.selected[a];if(b.__id in this.records)return b}return null},getSelectedRows:function(){var a=[];for(var b in this.selected){var c=this.selected[b];c.__id in this.records&&a.push(c)}return a},getSelectedRowObj:function(){for(var a in this.selected){var b=this.selected[a];if(b.__id in this.records)return this.getRowObj(b)}return null},getSelectedRowObjs:function(){var a=[];for(var b in this.selected){var c=this.selected[b];c.__id in this.records&&a.push(this.getRowObj(c))}return a},getCellObj:function(a,b){var c=this.getRow(a);b=this.getColumn(b);return document.getElementById(this._getCellDomId(c,b))},getRowObj:function(a,b){var c=this,d=this.options;if(a==null)return null;if(typeof a=="string")return c._isRowId(a)?document.getElementById(c.id+(b?"|1|":"|2|")+a):document.getElementById(c.id+(b?"|1|":"|2|")+c.rows[parseInt(a)].__id);if(typeof a=="number")return document.getElementById(c.id+(b?"|1|":"|2|")+c.rows[a].__id);if(typeof a=="object"&&a.__id)return c.getRowObj(a.__id,b);return a},getRow:function(a){var b=this,c=this.options;if(a==null)return null;if(typeof a=="string")return b._isRowId(a)?b.records[a]:b.rows[parseInt(a)];if(typeof a=="number")return b.rows[parseInt(a)];if(typeof a=="object"&&a.nodeType==1&&!a.__id)return b._getRowByDomId(a.id);return a},_setColumnVisible:function(a,b){var c=this,d=this.options;if(!b){a._hide=!1,document.getElementById(a.__domid).style.display="";if(a.__pid!=-1){var e=c._columns[a.__pid];e._hide&&(document.getElementById(e.__domid).style.display="",this._setColumnVisible(e,b))}}else{a._hide=!0,document.getElementById(a.__domid).style.display="none";if(a.__pid!=-1){var f=!0,e=this._columns[a.__pid];for(var g=0;e&&g<e.columns.length;g++)if(!e.columns[g]._hide){f=!1;break}f&&(e._hide=!0,document.getElementById(e.__domid).style.display="none",this._setColumnVisible(e,b))}}},toggleCol:function(a,b,c){var d=this,e=this.options,f;if(typeof a=="number")f=d.columns[a];else if(typeof a=="object"&&a.__id)f=a;else if(typeof a=="string")if(d._isColumnId(a))f=d._columns[a];else{$(d.columns).each(function(){this.name==a&&d.toggleCol(this,b,c)});return}if(!!f){var g=f.__leafindex,h=document.getElementById(f.__domid);if(!h)return;h=$(h);var i=[];for(var j in d.rows){var k=d.getCellObj(d.rows[j],f);k&&i.push(k)}for(var j=0;j<d.totalNumber;j++){var l=document.getElementById(d.id+"|total"+j+"|"+f.__id);l&&i.push(l)}var m=f._width;b&&f._hide?(f.frozen?d.f.gridtablewidth+=parseInt(m)+1:d.gridtablewidth+=parseInt(m)+1,d._setColumnVisible(f,!1),$(i).show()):!b&&!f._hide&&(f.frozen?d.f.gridtablewidth-=parseInt(m)+1:d.gridtablewidth-=parseInt(m)+1,d._setColumnVisible(f,!0),$(i).hide()),f.frozen?($("div:first",d.f.gridheader).width(d.f.gridtablewidth),$("div:first",d.f.gridbody).width(d.f.gridtablewidth)):($("div:first",d.gridheader).width(d.gridtablewidth+40),$("div:first",d.gridbody).width(d.gridtablewidth)),d._updateFrozenWidth(),c||$(":checkbox[columnindex="+g+"]",d.popup).each(function(){this.checked=b;if($.fn.ligerCheckBox){var a=$(this).ligerGetCheckBoxManager();a&&a.updateStyle()}})}},setColumnWidth:function(a,b){var c=this,d=this.options;if(!!b){b=parseInt(b,10);var e;if(typeof a=="number")e=c.columns[a];else if(typeof a=="object"&&a.__id)e=a;else if(typeof a=="string")if(c._isColumnId(a))e=c._columns[a];else{$(c.columns).each(function(){this.name==a&&c.setColumnWidth(this,b)});return}if(!e)return;var f=d.minColumnWidth;e.minWidth&&(f=e.minWidth),b=b<f?f:b;var g=b-e._width;if(c.trigger("beforeChangeColumnWidth",[e,b])==!1)return;e._width=b,e.frozen?(c.f.gridtablewidth+=g,$("div:first",c.f.gridheader).width(c.f.gridtablewidth),$("div:first",c.f.gridbody).width(c.f.gridtablewidth)):(c.gridtablewidth+=g,$("div:first",c.gridheader).width(c.gridtablewidth+40),$("div:first",c.gridbody).width(c.gridtablewidth)),$(document.getElementById(e.__domid)).css("width",b);var h=[];for(var i in c.records){var j=c.getCellObj(c.records[i],e);j&&h.push(j);if(!c.enabledDetailEdit()&&c.editors[i]&&c.editors[i][e.__id]){var k=c.editors[i][e.__id];k.editor.resize&&k.editor.resize(k.input,b,k.container.height(),k.editParm)}}for(var l=0;l<c.totalNumber;l++){var m=document.getElementById(c.id+"|total"+l+"|"+e.__id);m&&h.push(m)}$(h).css("width",b).find("> div.l-grid-row-cell-inner:first").css("width",b-8),c._updateFrozenWidth(),c.trigger("afterChangeColumnWidth",[e,b])}},changeHeaderText:function(a,b){var c=this,d=this.options,e;if(typeof a=="number")e=c.columns[a];else if(typeof a=="object"&&a.__id)e=a;else if(typeof a=="string")if(c._isColumnId(a))e=c._columns[a];else{$(c.columns).each(function(){this.name==a&&c.changeHeaderText(this,b)});return}if(!!e){var f=e.__leafindex,g=document.getElementById(e.__domid);$(".l-grid-hd-cell-text",g).html(b),d.allowHideColumn&&$(":checkbox[columnindex="+f+"]",c.popup).parent().next().html(b)}},changeCol:function(a,b,c){var d=this,e=this.options;if(!!a&&!!b){var f=d.getColumn(a),g=d.getColumn(b);f.frozen=g.frozen;var h,i,j=f.__pid==-1?e.columns:d._columns
[f.__pid].columns,k=g.__pid==-1?e.columns:d._columns[g.__pid].columns;h=$.inArray(f,j),i=$.inArray(g,k);var l=j==k,m=f.__level==g.__level;k.splice(i+(c?1:0),0,f),l?c?j.splice(h,1):j.splice(h+1,1):j.splice(h,1),d._setColumns(e.columns),d.reRender()}},collapseDetail:function(a){var b=this,c=this.options,d=b.getRow(a);if(!!d)for(var e=0,f=b.columns.length;e<f;e++)if(b.columns[e].isdetail){var g=b.getRowObj(d),h=b.getCellObj(d,b.columns[e]);$(g).next("tr.l-grid-detailpanel").hide(),$(".l-grid-row-cell-detailbtn:first",h).removeClass("l-open"),b.trigger("SysGridHeightChanged");return}},extendDetail:function(a){var b=this,c=this.options,d=b.getRow(a);if(!!d)for(var e=0,f=b.columns;e<f;e++)if(b.columns[e].isdetail){var g=b.getRowObj(d),h=b.getCellObj(d,b.columns[e]);$(g).next("tr.l-grid-detailpanel").show(),$(".l-grid-row-cell-detailbtn:first",h).addClass("l-open"),b.trigger("SysGridHeightChanged");return}},getParent:function(a){var b=this,c=this.options;if(!c.tree)return null;var d=b.getRow(a);if(!d)return null;return d.__pid in b.records?b.records[d.__pid]:null},getChildren:function(a,b){function g(a){if(a[d.tree.childrenName])for(var c=0,e=a[d.tree.childrenName].length;c<e;c++){var h=a[d.tree.childrenName][c];if(h.__status=="delete")continue;f.push(h),b&&g(h)}}var c=this,d=this.options;if(!d.tree)return null;var e=c.getRow(a);if(!e)return null;var f=[];g(e);return f},isLeaf:function(a){var b=this,c=this.options,d=b.getRow(a);if(!!d)return d.__hasChildren?!1:!0},hasChildren:function(a){var b=this,c=this.options,d=this.getRow(a);if(!!d)return d[c.tree.childrenName]&&d[c.tree.childrenName].length?!0:!1},existRecord:function(a){for(var b in this.records)if(this.records[b]==a)return!0;return!1},_removeSelected:function(a){var b=this,c=this.options;if(c.tree){var d=b.getChildren(a,!0);if(d)for(var e=0,f=d.length;e<f;e++){var g=$.inArray(d[e],b.selected);g!=-1&&b.selected.splice(g,1)}}var h=$.inArray(a,b.selected);h!=-1&&b.selected.splice(h,1)},_getParentChildren:function(a){var b=this,c=this.options,d=b.getRow(a),e;c.tree&&b.existRecord(d)&&d.__pid in b.records?e=b.records[d.__pid][c.tree.childrenName]:e=b.currentData[c.root];return e},_removeData:function(a){var b=this,c=this.options,d=b._getParentChildren(a),e=$.inArray(a,d);e!=-1&&d.splice(e,1),b._removeSelected(a)},_addData:function(a,b,c,d){var e=this,f=this.options,g=e.currentData[f.root];if(c){f.tree&&(b?g=b[f.tree.childrenName]:c.__pid in e.records&&(g=e.records[c.__pid][f.tree.childrenName]));var h=$.inArray(c,g);g.splice(h==-1?-1:h+(d?0:1),0,a)}else f.tree&&b&&(g=b[f.tree.childrenName]),g.push(a)},_appendData:function(a,b,c,d){var e=this,f=this.options;a[f.statusName]="update",e._removeData(a),e._addData(a,b,c,d)},appendRange:function(a,b,c,d){var e=this,f=this.options,g=!1;$.each(a,function(a,f){f.__id&&e.existRecord(f)?(e.isLeaf(b)&&e.upgrade(b),e._appendData(f,b,c,d),g=!0):e.appendRow(f,b,c,d)}),g&&e.reRender()},appendRow:function(a,b,c,d){var e=this,f=this.options;if($.isArray(a))e.appendRange(a,b,c,d);else{if(a.__id&&e.existRecord(a)){e._appendData(a,b,c,d),e.reRender();return}b&&e.isLeaf(b)&&e.upgrade(b),e.addRow(a,c,d?!0:!1,b)}},upgrade:function(a){var b=this,c=this.options,d=b.getRow(a);if(!!d&&!!c.tree){d[c.tree.childrenName]=d[c.tree.childrenName]||[],d.__hasChildren=!0;var e=[b.getRowObj(d)];b.enabledFrozen()&&e.push(b.getRowObj(d,!0)),$("> td > div > .l-grid-tree-space:last",e).addClass("l-grid-tree-link l-grid-tree-link-open")}},demotion:function(a){var b=this,c=this.options,d=b.getRow(a);if(!!d&&!!c.tree){var e=[b.getRowObj(d)];b.enabledFrozen()&&e.push(b.getRowObj(d,!0)),$("> td > div > .l-grid-tree-space:last",e).removeClass("l-grid-tree-link l-grid-tree-link-open l-grid-tree-link-close");if(b.hasChildren(d)){var f=b.getChildren(d);for(var g=0,h=f.length;g<h;g++)b.deleteRow(f[g])}d.__hasChildren=!1}},collapse:function(a){var b=this,c=this.options,d=b.getRowObj(a),e=$(".l-grid-tree-link",d);e.hasClass("l-grid-tree-link-close")||b.toggle(a)},expand:function(a){var b=this,c=this.options,d=b.getRowObj(a),e=$(".l-grid-tree-link",d);e.hasClass("l-grid-tree-link-open")||b.toggle(a)},toggle:function(a){if(!!a){var b=this,c=this.options,d=b.getRow(a),e=[b.getRowObj(d)];b.enabledFrozen()&&e.push(b.getRowObj(d,!0));var f=d.__level,g,h=$(".l-grid-tree-link:first",e),i=!0;b.collapsedRows=b.collapsedRows||[],h.hasClass("l-grid-tree-link-close")?(h.removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),g=$.inArray(d,b.collapsedRows),g!=-1&&b.collapsedRows.splice(g,1)):(i=!1,h.addClass("l-grid-tree-link-close").removeClass("l-grid-tree-link-open"),g=$.inArray(d,b.collapsedRows),g==-1&&b.collapsedRows.push(d));var j=b.getChildren(d,!0);for(var k=0,l=j.length;k<l;k++){var m=j[k],n=$([b.getRowObj(m.__id)]);b.enabledFrozen()&&(n=n.add(b.getRowObj(m.__id,!0))),i?($(".l-grid-tree-link",n).removeClass("l-grid-tree-link-close").addClass("l-grid-tree-link-open"),n.show()):($(".l-grid-tree-link",n).removeClass("l-grid-tree-link-open").addClass("l-grid-tree-link-close"),n.hide())}}},_bulid:function(){var a=this;a._clearGrid(),a._initBuildHeader(),a._initHeight(),a._initFootbar(),a._buildPager(),a._setEvent()},_setColumns:function(a){var b=this;b._initColumns(),b._initBuildGridHeader(),b._initBuildPopup()},_initBuildHeader:function(){var a=this,b=this.options;b.title?($(".l-panel-header-text",a.header).html(b.title),b.headerImg&&a.header.append("<img src='"+b.headerImg+"' />").addClass("l-panel-header-hasicon")):a.header.hide(),b.toolbar?$.fn.ligerToolBar&&(a.toolbarManager=a.topbar.ligerToolBar(b.toolbar)):a.topbar.remove()},_createColumnId:function(a){if(a.id!=null)return a.id.toString();return"c"+(100+this._columnCount)},_isColumnId:function(a){return a in this._columns},_initColumns:function(){function d(b,e,f,g){c(b,["__id","__pid","__previd","__nextid","__domid","__leaf","__leafindex","__level","__colSpan","__rowSpan"]),e>a._columnMaxLevel&&(a._columnMaxLevel=e),a._columnCount++,b.__id=a._createColumnId(b),b.__domid=a.id+"|hcell|"+b.__id,a._columns[b.__id]=b;if(!b.columns||!b.columns.length)b.__leafindex=a._columnLeafCount++;b.__level=e,b.__pid=f,b.__previd=g;if(!b.columns||!b.columns.length){b.__leaf=!0;return 1}var h=0,i=-1;for(var j=0,k=b.columns.length;j<k;j++){var l=b.columns[j];h+=d(l,e+1,b.__id,i),i=l.__id}b.__leafcount=h;return h}function c(a,b){for(var c in b)b[c]in a&&delete a[b[c]]}var a=this,b=this.options;a._columns={},a._columnCount=0,a._columnLeafCount=0,a._columnMaxLevel=1;if(!!b.columns){var e=-1;if(b.rownumbers){var f=a.enabledGroup()?!1:b.frozen&&b.frozenRownumbers,g={isrownumber:!0,issystem:!0,width:b.rownumbersColWidth,frozen:f};d(g,1,-1,e),e=g.__id}if(a.enabledDetail()){var h=a.enabledGroup()?!1:b.frozen&&b.frozenDetail,g={isdetail:!0,issystem:!0,width:b.detailColWidth,frozen:h};d(g,1,-1,e),e=g.__id}if(a.enabledCheckbox()){var i=a.enabledGroup()?!1:b.frozen&&b.frozenCheckbox,g={ischeckbox:!0,issystem:!0,width:b.detailColWidth,frozen:i};d(g,1,-1,e),e=g.__id}for(var j=0,k=b.columns.length;j<k;j++){var g=b.columns[j];d(g,1,-1,e),e=g.__id}for(var l in a._columns){var g=a._columns[l];g.__leafcount>1&&(g.__colSpan=g.__leafcount),g.__leaf&&g.__level!=a._columnMaxLevel&&(g.__rowSpan=a._columnMaxLevel-g.__level+1)}a.columns=a.getColumns(),$(a.columns).each(function(b,c){c.columnname=c.name,c.columnindex=b,c.type=c.type||"string",c.islast=b==a.columns.length-1,c.isSort=c.isSort==!1?!1:!0,c.frozen=c.frozen?!0:!1,c._width=a._getColumnWidth(c),c._hide=c.hide?!0:!1})}},_getColumnWidth:function(a){var b=this,c=this.options;if(a._width)return a._width;var d;a.width?d=a.width:c.columnWidth&&(d=c.columnWidth);if(!d){var e=4;b.enabledCheckbox()&&(e+=c.checkboxColWidth),b.enabledDetail()&&(e+=c.detailColWidth),d=parseInt((b.grid.width()-e)/b.columns.length)}typeof d=="string"&&d.indexOf("%")>0&&(a._width=d=parseInt(parseInt(d)*.01*(b.grid.width()-b.columns.length))),a.minWidth&&d<a.minWidth&&(d=a.minWidth),a.maxWidth&&d>a.maxWidth&&(d=a.maxWidth),a._width=d;return d},_createHeaderCell:function(a){var b=this,c=this.options,d=$("<td class='l-grid-hd-cell'><div class='l-grid-hd-cell-inner'><span class='l-grid-hd-cell-text'></span></div></td>");d.attr("id",a.__domid),a.__leaf||d.addClass("l-grid-hd-cell-mul"),a.columnindex==b.columns.length-1&&d.addClass("l-grid-hd-cell-last"),a.isrownumber&&(d.addClass("l-grid-hd-cell-rownumbers"),d.html("<div class='l-grid-hd-cell-inner'></div>")),a.ischeckbox&&(d.addClass("l-grid-hd-cell-checkbox"),d.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-checkbox'></div></div>")),a.isdetail&&(d.addClass("l-grid-hd-cell-detail"),d.html("<div class='l-grid-hd-cell-inner'><div class='l-grid-hd-cell-text l-grid-hd-cell-btn-detail'></div></div>")),a.heightAlign&&$(".l-grid-hd-cell-inner:first",d).css("textAlign",a.heightAlign),a.__colSpan&&d.attr("colSpan",a.__colSpan),a.__rowSpan?(d.attr("rowSpan",a.__rowSpan),d.height(c.headerRowHeight*a.__rowSpan)):d.height(c.headerRowHeight),a.__leaf&&(d.width(a._width),d.attr("columnindex",a.__leafindex)),a._hide&&d.hide(),a.name&&d.attr({columnname:a.name});var e="";a.display&&a.display!=""?e=a.display:a.headerRender?e=a.headerRender(a):e="&nbsp;",$(".l-grid-hd-cell-text:first",d).html(e),!a.issystem&&a.__leaf&&a.resizable!==!1&&$.fn.ligerResizable&&(b.colResizable[a.__id]=d.ligerResizable({handles:"e",onStartResize:function(a,c){this.proxy.hide(),b.draggingline.css({height:b.body.height(),top:0,left:c.pageX-b.grid.offset().left+parseInt(b.body[0].scrollLeft)}).show()},onResize:function(a,c){b.colresizing=!0,b.draggingline.css({left:c.pageX-b.grid.offset().left+parseInt(b.body[0].scrollLeft)}),$("body").add(d).css("cursor","e-resize")},onStopResize:function(c){b.colresizing=!1,$("body").add(d).css("cursor","default"),b.draggingline.hide(),b.setColumnWidth(a,a._width+c.diffX);return!1}}));return d},_initBuildGridHeader:function(){var a=this,b=this.options;a.gridtablewidth=0,a.f.gridtablewidth=0;if(a.colResizable){for(var c in a.colResizable)a.colResizable[c].destroy();a.colResizable=null}a.colResizable={},$("tbody:first",a.gridheader).html(""),$("tbody:first",a.f.gridheader).html("");for(var d=1;d<=a._columnMaxLevel;d++){var e=a.getColumns(d),f=d==a._columnMaxLevel,g=$("<tr class='l-grid-hd-row'></tr>"),h=$("<tr class='l-grid-hd-row'></tr>");f||g.add(h).addClass("l-grid-hd-mul"),$("tbody:first",a.gridheader).append(g),$("tbody:first",a.f.gridheader).append(h),$(e).each(function(b,c){(c.frozen?h:g).append(a._createHeaderCell(c));if(c.__leaf){var d=c._width;c.frozen?a.f.gridtablewidth+=(parseInt(d)?parseInt(d):0)+1:a.gridtablewidth+=(parseInt(d)?parseInt(d):0)+1}})}if(a._columnMaxLevel>0){var i=b.headerRowHeight*a._columnMaxLevel;a.gridheader.add(a.f.gridheader).height(i),b.rownumbers&&b.frozenRownumbers&&a.f.gridheader.find("td:first").height(i)}a._updateFrozenWidth(),$("div:first",a.gridheader).width(a.gridtablewidth+40)},_initBuildPopup:function(){var a=this,b=this.options;$(":checkbox",a.popup).unbind(),$("tbody tr",a.popup).remove(),$(a.columns).each(function(b,c){if(!c.issystem){if(c.isAllowHide==!1)return;var d='checked="checked"';c._hide&&(d="");var e=c.display;$("tbody",a.popup).append('<tr><td class="l-column-left"><input type="checkbox" '+d+' class="l-checkbox" columnindex="'+b+'"/></td><td class="l-column-right">'+e+"</td></tr>")}}),$.fn.ligerCheckBox&&$("input:checkbox",a.popup).ligerCheckBox({onBeforeClick:function(c){if(!c.checked)return!0;if($("input:checked",a.popup).length<=b.minColToggle)return!1;return!0}});if(b.allowHideColumn){$("tr",a.popup).hover(function(){$(this).addClass("l-popup-row-over")},function(){$(this).removeClass("l-popup-row-over")});var c=function(){if($("input:checked",a.popup).length+1<=b.minColToggle)return!1;a.toggleCol(parseInt($(this).attr("columnindex")),this.checked,!0)};$.fn.ligerCheckBox?$(":checkbox",a.popup).bind("change",c):$(":checkbox",a.popup).bind("click",c)}},_initHeight:function(){var a=this,b=this.options;b.height=="auto"&&(a.gridbody.height("auto"),a.f.gridbody.height("auto")),b.width&&a.grid.width(b.width),a._onResize.call(a)},_initFootbar:function(){var a=this,b=this.options;if(b.usePager){var c="",d=-1;$(b.pageSizeOptions).each(function(a,e){var f="";b.pageSize==e&&(d=a),c+="<option value='"+e+"' "+f+" >"+e+"</option>"}),$(".l-bar-selectpagesize",a.toolbar).append("<select name='rp'>"+c+"</select>"),d!=-1&&($(".l-bar-selectpagesize select",a.toolbar)[0].selectedIndex=d),b.switchPageSizeApplyComboBox&&$.fn.ligerComboBox&&$(".l-bar-selectpagesize select",a.toolbar).ligerComboBox({onBeforeSelect:function(){if(b.url&&a.isDataChanged&&!confirm(b.isContinueByDataChanged))return!1;return!0},width:45})}else a.toolbar.hide()},_searchData:function(a,b){var c=this,d=this.options,e=[];for(var f=0;f<a.length;f++)b(a[f],f)&&(e[e.length]=a[f]);return e},_clearGrid:function(){var a=this,b=this.options;for(var c in a.rows){var d=$(a.getRowObj(a.rows[c]));a.enabledFrozen()&&(d=d.add(a.getRowObj(a.rows[c],!0))),d.unbind()}a.gridbody.html(""),a.f.gridbody.html(""),a.recordNumber=0,a.records={},a.rows=[],a.selected=[],a.totalNumber=0,a.editorcounter=0},_fillGridBody:function(a,b){var c=this,d=this.options,e=['<div class="l-grid-body-inner"><table class="l-grid-body-table" cellpadding=0 cellspacing=0><tbody>'];if(c.enabledGroup()){var f=[],g=[];c.groups=g;for(var h in a){var i=a[h],j=i[d.groupColumnName],k=$.inArray(j,f);k==-1&&(f.push(j),k=f.length-1,g.push([])),g[k].push(i)}$(g).each(function(a,h){g.length==1&&e.push('<tr class="l-grid-grouprow l-grid-grouprow-last l-grid-grouprow-first"'),a==g.length-1?e.push('<tr class="l-grid-grouprow l-grid-grouprow-last"'):a==0?e.push('<tr class="l-grid-grouprow l-grid-grouprow-first"'):e.push('<tr class="l-grid-grouprow"'),e.push(' groupindex"='+a+'" >'),e.push('<td colSpan="'+c.columns.length+'" class="l-grid-grouprow-cell">'),e.push('<span class="l-grid-group-togglebtn">&nbsp;&nbsp;&nbsp;&nbsp;</span>'),d.groupRender?e.push(d.groupRender(f[a],h,d.groupColumnDisplay)):e.push(d.groupColumnDisplay+":"+f[a]),e.push("</td>"),e.push("</tr>"),e.push(c._getHtmlFromData(h,b)),c.isTotalSummary()&&e.push(c._getTotalSummaryHtml(h,"l-grid-totalsummary-group",b))})}else e.push(c._getHtmlFromData(a,b));e.push("</tbody></table></div>"),(b?c.f.gridbody:c.gridbody).html(e.join("")),c.enabledGroup()||c._bulidTotalSummary(b),$("> div:first",c.gridbody).width(c.gridtablewidth),c._onResize()},_showData:function(){var a=this,b=this.options,c=a.currentData[b.root];b.usePager&&(b.dataAction=="server"&&a.data&&a.data[b.record]?b.total=a.data[b.record]:a.filteredData&&a.filteredData[b.root]?b.total=a.filteredData[b.root].length:a.data&&a.data[b.root]?b.total=a.data[b.root].length:c&&(b.total=c.length),b.page=b.newPage,b.total||(b.total=0),b.page||(b.page=1),b.pageCount=Math.ceil(b.total/b.pageSize),b.pageCount||(b.pageCount=1),a._buildPager()),$(".l-bar-btnloading:first",a.toolbar).removeClass("l-bar-btnloading");if(a.trigger("beforeShowData",[a.currentData])!=!1){a._clearGrid(),a.isDataChanged=!1;if(!c)return;$(".l-bar-btnload:first span",a.toolbar).removeClass("l-disabled"),a._updateGridData(),a.enabledFrozen()&&a._fillGridBody(a.rows,!0),a._fillGridBody(a.rows,!1),a.trigger("SysGridHeightChanged"),b.totalRender&&($(".l-panel-bar-total",a.element).remove(),$(".l-panel-bar",a.element).before('<div class="l-panel-bar-total">'+b.totalRender(a.data,a.filteredData)+"</div>"));if(b.mouseoverRowCssClass)for(var d in a.rows){var e=$(a.getRowObj(a.rows[d]));a.enabledFrozen()&&(e=e.add(a.getRowObj(a.rows[d],!0))),e.bind("mouseover.gridrow",function(){a._onRowOver(this,!0)}).bind("mouseout.gridrow",function(){a._onRowOver(this,!1)})}a.gridbody.trigger("scroll.grid"),a.trigger("afterShowData",[a.currentData])}},_getRowDomId:function(a,b){return this.id+"|"+(b?"1":"2")+"|"+a.__id},_getCellDomId:function(a,b){return this._getRowDomId(a,b.frozen)+"|"+b.__id},_getHtmlFromData:function(a,b){if(!a)return"";var c=this,d=this.options,e=[];for(var f in a){var g=a[f],h=g.__id;if(!g)continue;e.push("<tr"),e.push(' id="'+c._getRowDomId(g,b)+'"'),e.push(' class="l-grid-row'),!b&&c.enabledCheckbox()&&d.isChecked&&d.isChecked(g)?(c.select(g),e.push(" l-selected")):c.isSelected(g)&&e.push(" l-selected"),g.__index%2==1&&d.alternatingRow&&e.push(" l-grid-row-alt"),e.push('" '),d.rowAttrRender&&e.push(d.rowAttrRender(g,h));if(d.tree&&c.collapsedRows&&c.collapsedRows.length){var i=function(){var a=c.getParent(g);while(a){if($.inArray(a,c.collapsedRows)!=-1)return!0;a=c.getParent(a)}return!1};i()&&e.push(' style="display:none;" ')}e.push(">"),$(c.columns).each(function(a,f){if(b==f.frozen){e.push("<td"),e.push(' id="'+c._getCellDomId(g,this)+'"');if(this.isrownumber){e.push(' class="l-grid-row-cell l-grid-row-cell-rownumbers" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),d.fixedCellHeight&&e.push(' style = "height:'+d.rowHeight+'px;" '),e.push(">"+(parseInt(g.__index)+1)+"</div></td>");return}if(this.ischeckbox){e.push(' class="l-grid-row-cell l-grid-row-cell-checkbox" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),d.fixedCellHeight&&e.push(' style = "height:'+d.rowHeight+'px;" '),e.push('><span class="l-grid-row-cell-btn-checkbox"></span></div></td>');return}if(this.isdetail){e.push(' class="l-grid-row-cell l-grid-row-cell-detail" style="width:'+this.width+'px"><div class="l-grid-row-cell-inner"'),d.fixedCellHeight&&e.push(' style = "height:'+d.rowHeight+'px;" '),e.push('><span class="l-grid-row-cell-detailbtn"></span></div></td>');return}var i=this._width;e.push(' class="l-grid-row-cell '),c.changedCells[h+"_"+this.__id]&&e.push("l-grid-row-cell-edited "),this.islast&&e.push("l-grid-row-cell-last "),e.push('"'),e.push(' style = "'),e.push("width:"+i+"px; "),f._hide&&e.push("display:none;"),e.push(' ">'),e.push(c._getCellHtml(g,f)),e.push("</td>")}}),e.push("</tr>")}return e.join("")},_getCellHtml:function(a,b){var c=this,d=this.options;if(b.isrownumber)return'<div class="l-grid-row-cell-inner">'+(parseInt(a.__index)+1)+"</div>";var e=[];e.push('<div class="l-grid-row-cell-inner"'),e.push(' style = "width:'+parseInt(b._width-8)+"px;"),d.fixedCellHeight&&e.push("height:"+d.rowHeight+"px;min-height:"+d.rowHeight+"px; "),b.align&&e.push("text-align:"+b.align+";");var f=c._getCellContent(a,b);e.push('">'+f+"</div>");return e.join("")},_getCellContent:function(a,b){if(!a||!b)return"";if(b.isrownumber)return parseInt(a.__index)+1;var c=a.__id,d=a.__index,e=b.name?a[b.name]:null,f=this,g=this.options,h="";b.render?h=b.render.call(f,a,d,e,b):g.formatters[b.type]?h=g.formatters[b.type].call(f,e,b):e!=null&&(h=e.toString()),g.tree&&(g.tree.columnName!=null&&g.tree.columnName==b.name||g.tree.columnId!=null&&g.tree.columnId==b.id)&&(h=f._getTreeCellHtml(h,a));return h||""},_getTreeCellHtml:function(a,b){var c=b.__level,d=this,e=this.options,f=$.inArray(b,d.collapsedRows||[])==-1,g=e.tree.isParent(b),h="";c=parseInt(c)||1;for(var i=1;i<c;i++)h+="<div class='l-grid-tree-space'></div>";f&&g?h+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-open'></div>":g?h+="<div class='l-grid-tree-space l-grid-tree-link l-grid-tree-link-close'></div>":h+="<div class='l-grid-tree-space'></div>",h+="<span class='l-grid-tree-content'>"+a+"</span>";return h},_applyEditor:function(a){var b=this,c=this.options,d=a,e=d.id.split("|"),f=e[e.length-1],g=b._columns[f],h=$(d).parent(),i=b.getRow(h[0]),j=i.__id,k=i.__index;if(!!g&&!!g.editor){var l=g.name,m=g.columnindex;if(g.editor.type&&c.editors[g.editor.type]){var n=i[l],o={record:i,value:n,column:g,rowindex:k};if(b.trigger("beforeEdit",[o])==!1)return!1;var p=c.editors[g.editor.type],q=$(d),r=$(d).offset();q.html(""),b.setCellEditing(i,g,!0);var s=$(d).width(),t=$(d).height(),u=$("<div class='l-grid-editor'></div>").appendTo("body");$.browser.mozilla?u.css({left:r.left,top:r.top}).show():u.css({left:r.left+1,top:r.top+1}).show();var v=b._createEditor(p,u,o,s,t);b.editor={editing:!0,editor:p,input:v,editParm:o,container:u},b.unbind("sysEndEdit"),b.bind("sysEndEdit",function(){var a=p.getValue(v,o);a!=n&&($(d).addClass("l-grid-row-cell-edited"),b.changedCells[j+"_"+g.__id]=!0,g.editor.onChange&&g.editor.onChange(d,a),o.value=a,b._checkEditAndUpdateCell(o)&&g.editor.onChanged&&g.editor.onChanged(d,a))})}}},_checkEditAndUpdateCell:function(a){var b=this,c=this.options;if(b.trigger("beforeSubmitEdit",[a])==!1)return!1;b.updateCell(a.column,a.value,a.record),(a.column.render||b.enabledTotal())&&b.reRender({column:a.column}),b.reRender({rowdata:a.record});return!0},_getCurrentPageData:function(a){var b=this,c=this.options,d={};d[c.root]=[];if(!a||!a[c.root]||!a[c.root].length){d[c.record]=0;return d}d[c.record]=a[c.root].length,c.newPage||(c.newPage=1);for(i=(c.newPage-1)*c.pageSize;i<a[c.root].length&&i<c.newPage*c.pageSize;i++)d[c.root].push(a[c.root][i]);return d},_compareData:function(a,b,c,d){var e=this,f=this.options,g=a[c],h=b[c];if(g==null&&h!=null)return 1;if(g==null&&h==null)return 0;if(g!=null&&h==null)return-1;return f.sorters[d]?f.sorters[d].call(e,g,h):g<h?-1:g>h?1:0},_getTotalCellContent:function(a,b){var c=this,d=this.options,e=[];if(a.totalSummary){var f=function(a){for(var b=0;b<o.length;b++)if(o[b].toLowerCase()==a.toLowerCase())return!0;return!1},g=0,h=0,i=0,j=parseFloat(b[0][a.name]),k=parseFloat(b[0][a.name]);for(var l=0;l<b.length;l++){h+=1;var m=parseFloat(b[l][a.name]);if(!m)continue;g+=m,m>j&&(j=m),m<k&&(k=m)}i=g*1/b.length;if(a.totalSummary.render){var n=a.totalSummary.render({sum:g,count:h,avg:i,min:k,max:j},a,c.data);e.push(n)}else if(a.totalSummary.type){var o=a.totalSummary.type.split(",");f("sum")&&e.push("<div>Sum="+g.toFixed(2)+"</div>"),f("count")&&e.push("<div>Count="+h+"</div>"),f("max")&&e.push("<div>Max="+j.toFixed(2)+"</div>"),f("min")&&e.push("<div>Min="+k.toFixed(2)+"</div>"),f("avg")&&e.push("<div>Avg="+i.toFixed(2)+"</div>")}}return e.join("")},_getTotalSummaryHtml:function(a,b,c){var d=this,e=this.options,f=[];b?f.push('<tr class="l-grid-totalsummary '+b+'">'):f.push('<tr class="l-grid-totalsummary">'),$(d.columns).each(function(b,e){if(this.frozen==c){if(this.isrownumber){f.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-rownumbers" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}if(this.ischeckbox){f.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-checkbox" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}if(this.isdetail){f.push('<td class="l-grid-totalsummary-cell l-grid-totalsummary-cell-detail" style="width:'+this.width+'px"><div>&nbsp;</div></td>');return}f.push('<td class="l-grid-totalsummary-cell'),this.islast&&f.push(" l-grid-totalsummary-cell-last"),f.push('" '),f.push('id="'+d.id+"|total"+d.totalNumber+"|"+e.__id+'" '),f.push('width="'+this._width+'" '),columnname=this.columnname,columnname&&f.push('columnname="'+columnname+'" '),f.push('columnindex="'+b+'" '),f.push('><div class="l-grid-totalsummary-cell-inner"'),e.align&&f.push(' style="text-Align:'+e.align+';"'),f.push(">"),f.push(d._getTotalCellContent(e,a)),f.push("</div></td>")}}),f.push("</tr>"),c||d.totalNumber++;return f.join("")},_bulidTotalSummary:function(a){var b=this,c=this.options;if(!b.isTotalSummary())return!1;if(!b.currentData||b.currentData[c.root].length==0)return!1;var d=$(b._getTotalSummaryHtml(b.currentData[c.root],null,a));$("tbody:first",a?b.f.gridbody:b.gridbody).append(d)},_buildPager:function(){var a=this,b=this.options;$(".pcontrol input",a.toolbar).val(b.page),b.pageCount||(b.pageCount=1),$(".pcontrol span",a.toolbar).html(b.pageCount);var c=parseInt((b.page-1)*b.pageSize)+1,d=parseInt(c)+parseInt(b.pageSize)-1;b.total||(b.total=0),b.total<d&&(d=b.total),b.total||(c=d=0),c<0&&(c=0),d<0&&(d=0);var e=b.pageStatMessage;e=e.replace(/{from}/,c),e=e.replace(/{to}/,d),e=e.replace(/{total}/,b.total),e=e.replace(/{pagesize}/,b.pageSize),$(".l-bar-text",a.toolbar).html(e),b.total||$(".l-bar-btnfirst span,.l-bar-btnprev span,.l-bar-btnnext span,.l-bar-btnlast span",a.toolbar).addClass("l-disabled"),b.page==1?($(".l-bar-btnfirst span",a.toolbar).addClass("l-disabled"),$(".l-bar-btnprev span",a.toolbar).addClass("l-disabled")):b.page>b.pageCount&&b.pageCount>0&&($(".l-bar-btnfirst span",a.toolbar).removeClass("l-disabled"),$(".l-bar-btnprev span",a.toolbar).removeClass("l-disabled")),b.page==b.pageCount?($(".l-bar-btnlast span",a.toolbar).addClass("l-disabled"),$(".l-bar-btnnext span",a.toolbar).addClass("l-disabled")):b.page<b.pageCount&&b.pageCount>0&&($(".l-bar-btnlast span",a.toolbar).removeClass("l-disabled"),$(".l-bar-btnnext span",a.toolbar).removeClass("l-disabled"))},_getRowIdByDomId:function(a){var b=a.split("|"),c=b[2];return c},_getRowByDomId:function(a){return this.records[this._getRowIdByDomId(a)]},_getSrcElementByEvent:function(a){var b=this,c=a.target||a.srcElement,d=$(c).parents().add(c),e=function(a){for(var b=0,c=d.length;b<c;b++)if(typeof a=="string"){if($(d[b]).hasClass(a))return d[b]}else if(typeof a=="object"&&d[b]==a)return d[b];return null};if(e("l-grid-editor"))return{editing:!0,editor:e("l-grid-editor")};if(d.index(this.element)==-1)return{out:!0};var f=!1;if(d.hasClass("l-grid-detailpanel")&&b.detailrows)for(var g=0,h=b.detailrows.length;g<h;g++)if(d.index(b.detailrows[g])!=-1){f=!0;break}var i={grid:e("l-panel"),indetail:f,frozen:e(b.gridview1[0])?!0:!1,header:e("l-panel-header"),gridheader:e("l-grid-header"),gridbody:e("l-grid-body"),total:e("l-panel-bar-total"),popup:e("l-grid-popup"),toolbar:e("l-panel-bar")};if(i.gridheader){i.hrow=e("l-grid-hd-row"),i.hcell=e("l-grid-hd-cell"),i.hcelltext=e("l-grid-hd-cell-text"),i.checkboxall=e("l-grid-hd-cell-checkbox");if(i.hcell){var j=i.hcell.id.split("|")[2];i.column=b._columns[j]}}i.gridbody&&(i.row=e("l-grid-row"),i.cell=e("l-grid-row-cell"),i.checkbox=e("l-grid-row-cell-btn-checkbox"),i.groupbtn=e("l-grid-group-togglebtn"),i.grouprow=e("l-grid-grouprow"),i.detailbtn=e("l-grid-row-cell-detailbtn"),i.detailrow=e("l-grid-detailpanel"),i.totalrow=e("l-grid-totalsummary"),i.totalcell=e("l-grid-totalsummary-cell"),i.rownumberscell=$(i.cell).hasClass("l-grid-row-cell-rownumbers")?i.cell:null,i.detailcell=$(i.cell).hasClass("l-grid-row-cell-detail")?i.cell:null,i.checkboxcell=$(i.cell).hasClass("l-grid-row-cell-checkbox")?i.cell:null,i.treelink=e("l-grid-tree-link"),i.editor=e("l-grid-editor"),i.row&&(i.data=this._getRowByDomId(i.row.id)),i.cell&&(i.editing=$(i.cell).hasClass("l-grid-row-cell-editing")),i.editor&&(i.editing=!0),i.editing&&(i.out=!1)),i.toolbar&&(i.first=e("l-bar-btnfirst"),i.last=e("l-bar-btnlast"),i.next=e("l-bar-btnnext"),i.prev=e("l-bar-btnprev"),i.load=e("l-bar-btnload"),i.button=e("l-bar-button"));return i},_setEvent:function(){var a=this,b=this.options;a.grid.bind("mousedown.grid",function(b){a._onMouseDown.call(a,b)}),a.grid.bind("dblclick.grid",function(b){a._onDblClick.call(a,b)}),a.grid.bind("contextmenu.grid",function(b){return a._onContextmenu.call(a,b)}),$(document).bind("mouseup.grid",function(b){a._onMouseUp.call(a,b)}),$(document).bind("click.grid",function(b){a._onClick.call(a,b)}),$(window).bind("resize.grid",function(b){a._onResize.call(a)}),$(document).bind("keydown.grid",function(b){b.ctrlKey&&(a.ctrlKey=!0)}),$(document).bind("keyup.grid",function(b){delete a.ctrlKey}),a.gridbody.bind("scroll.grid",function(){var b=a.gridbody.scrollLeft(),c=a.gridbody.scrollTop();b!=null&&(a.gridheader[0].scrollLeft=b),c!=null&&(a.f.gridbody[0].scrollTop=c),a.endEdit(),a.trigger("SysGridHeightChanged")}),$("select",a.toolbar).change(function(){if(a.isDataChanged&&!confirm(b.isContinueByDataChanged))return!1;b.newPage=1,b.pageSize=this.value,a.loadData(b.where)}),$("span.pcontrol :text",a.toolbar).blur(function(b){a.changePage("input")}),$("div.l-bar-button",a.toolbar).hover(function(){$(this).addClass("l-bar-button-over")},function(){$(this).removeClass("l-bar-button-over")}),$.fn.ligerDrag&&b.colDraggable&&(a.colDroptip=$("<div class='l-drag-coldroptip' style='display:none'><div class='l-drop-move-up'></div><div class='l-drop-move-down'></div></div>").appendTo("body"),a.gridheader.add(a.f.gridheader).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(b,c){var d=a._getSrcElementByEvent(c);if(d.hcell&&d.column){var e=$(".l-grid-hd-cell-text:first",d.hcell).html(),f=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div></div>").appendTo("body");f.append(e);return f}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),a.children[this.id]=this},onStartDrag:function(b,c){if(c.button==2)return!1;if(a.colresizing)return!1;this.set("cursor","default");var d=a._getSrcElementByEvent(c);if(!d.hcell||!d.column||d.column.issystem||d.hcelltext)return!1;if($(d.hcell).css("cursor").indexOf("resize")!=-1)return!1;this.draggingColumn=d.column,a.coldragging=!0;var e=a.grid.offset();this.validRange={top:e.top,bottom:e.top+a.gridheader.height(),left:e.left-10,right:e.left+a.grid.width()+10}},onDrag:function(c,d){this.set("cursor","default");var e=this.draggingColumn;if(!e)return!1;if(a.colresizing)return!1;a.colDropIn==null&&(a.colDropIn=-1);var f=d.pageX,h=d.pageY,i=!1,j=a.grid.offset(),k=this.validRange;if(f<k.left||f>k.right||h>k.bottom||h<k.top)a.colDropIn=-1,a.colDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no");else for(var l in a._columns){var m=a._columns[l];if(e==m){i=!0;continue}if(m.issystem)continue;var n=m.__level==e.__level,o=n?i?!0:!1:!1;e.frozen!=m.frozen&&(o=m.frozen?!1:!0);if(a.colDropIn!=-1&&a.colDropIn!=l)continue;var q=document.getElementById(m.__domid),r=$(q).offset(),s={top:r.top,bottom:r.top+$(q).height(),left:r.left-10,right:r.left+10};if(o){var t=$(q).width();s.left+=t,s.right+=t}if(f>s.left&&f<s.right&&h>s.top&&h<s.bottom){var u=b.headerRowHeight;m.__rowSpan&&(u*=m.__rowSpan),a.colDroptip.css({left:s.left+5,top:s.top-9,height:u+18}).show(),a.colDropIn=l,a.colDropDir=o?"right":"left",this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no").addClass("l-drop-yes");break}a.colDropIn!=-1&&(a.colDropIn=-1,a.colDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes").addClass("l-drop-no"))}},onStopDrag:function(b,c){var d=this.draggingColumn;a.coldragging=!1,a.colDropIn!=-1&&(a.changeCol.ligerDefer(a,0,[d,a.colDropIn,a.colDropDir=="right"]),a.colDropIn=-1),a.colDroptip.hide(),this.set("cursor","default")}})),$.fn.ligerDrag&&b.rowDraggable&&(a.rowDroptip=$("<div class='l-drag-rowdroptip' style='display:none'></div>").appendTo("body"),a.gridbody.add(a.f.gridbody).ligerDrag({revert:!0,animate:!1,proxyX:0,proxyY:0,proxy:function(c,d){var e=a._getSrcElementByEvent(d);if(e.row){var f=b.draggingMessage.replace(/{count}/,c.draggingRows?c.draggingRows.length:1);b.rowDraggingRender&&(f=b.rowDraggingRender(c.draggingRows,c,a));var h=$("<div class='l-drag-proxy' style='display:none'><div class='l-drop-icon l-drop-no'></div>"+f+"</div>").appendTo("body");return h}},onRevert:function(){return!1},onRendered:function(){this.set("cursor","default"),a.children[this.id]=this},onStartDrag:function(b,c){if(c.button==2)return!1;if(a.colresizing)return!1;if(!a.columns.length)return!1;this.set("cursor","default");var d=a._getSrcElementByEvent(c);if(!d.cell||!d.data||d.checkbox)return!1;var e=d.cell.id.split("|"),f=a._columns[e[e.length-1]];if(!(d.rownumberscell||d.detailcell||d.checkboxcell||f==a.columns[0]))return!1;if(a.enabledCheckbox()){this.draggingRows=a.getSelecteds();if(!this.draggingRows||!this.draggingRows.length)return!1}else this.draggingRows=[d.data];this.draggingRow=d.data,this.set("cursor","move"),a.rowdragging=!0,this.validRange={top:a.gridbody.offset().top,bottom:a.gridbody.offset().top+a.gridbody.height(),left:a.grid.offset().left-10,right:a.grid.offset().left+a.grid.width()+10}},onDrag:function(c,d){var e=this.draggingRow;if(!e)return!1;var f=this.draggingRows?this.draggingRows:[e];if(a.colresizing)return!1;a.rowDropIn==null&&(a.rowDropIn=-1);var h=d.pageX,i=d.pageY,j=!1,k=this.validRange;if(h<k.left||h>k.right||i>k.bottom||i<k.top)a.rowDropIn=-1,a.rowDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes l-drop-add").addClass("l-drop-no");else for(var l in a.rows){var m=a.rows[l],n=m.__id;e==m&&(j=!0);if($.inArray(m,f)!=-1)continue;var o=j?!0:!1;if(a.rowDropIn!=-1&&a.rowDropIn!=n)continue;var q=a.getRowObj(n),r=$(q).offset(),s={top:r.top-4,bottom:r.top+$(q).height()+4,left:a.grid.offset().left,right:a.grid.offset().left+a.grid.width()};if(h>s.left&&h<s.right&&i>s.top&&i<s.bottom){var t=r.top;o&&(t+=$(q).height()),a.rowDroptip.css({left:s.left,top:t,width:s.right-s.left}).show(),a.rowDropIn=n,a.rowDropDir=o?"bottom":"top",b.tree&&i>s.top+5&&i<s.bottom-5?(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-yes").
addClass("l-drop-add"),a.rowDroptip.hide(),a.rowDropInParent=!0):(this.proxy.find(".l-drop-icon:first").removeClass("l-drop-no l-drop-add").addClass("l-drop-yes"),a.rowDroptip.show(),a.rowDropInParent=!1);break}a.rowDropIn!=-1&&(a.rowDropIn=-1,a.rowDropInParent=!1,a.rowDroptip.hide(),this.proxy.find(".l-drop-icon:first").removeClass("l-drop-yes  l-drop-add").addClass("l-drop-no"))}},onStopDrag:function(c,d){var e=this.draggingRows;a.rowdragging=!1;for(var f=0;f<e.length;f++){var h=e[f].children;h&&(e=$.grep(e,function(a,b){var c=$.inArray(a,h)==-1;return c}))}if(a.rowDropIn!=-1){if(b.tree){var i,j;a.rowDropInParent?j=a.getRow(a.rowDropIn):(i=a.getRow(a.rowDropIn),j=a.getParent(i)),a.appendRange(e,j,i,a.rowDropDir!="bottom"),a.trigger("rowDragDrop",{rows:e,parent:j,near:i,after:a.rowDropDir=="bottom"})}else a.moveRange(e,a.rowDropIn,a.rowDropDir=="bottom"),a.trigger("rowDragDrop",{rows:e,parent:j,near:a.getRow(a.rowDropIn),after:a.rowDropDir=="bottom"});a.rowDropIn=-1}a.rowDroptip.hide(),this.set("cursor","default")}}))},_onRowOver:function(a,b){if(!l.draggable.dragging){var c=this,d=this.options,e=c.getRow(a),f=b?"addClass":"removeClass";c.enabledFrozen()&&$(c.getRowObj(e,!0))[f](d.mouseoverRowCssClass),$(c.getRowObj(e,!1))[f](d.mouseoverRowCssClass)}},_onMouseUp:function(a){var b=this,c=this.options;if(l.draggable.dragging){var d=b._getSrcElementByEvent(a);d.hcell&&d.column?b.trigger("dragdrop",[{type:"header",column:d.column,cell:d.hcell},a]):d.row&&b.trigger("dragdrop",[{type:"row",record:d.data,row:d.row},a])}},_onMouseDown:function(a){var b=this,c=this.options},_onContextmenu:function(a){var b=this,c=this.options,d=b._getSrcElementByEvent(a);if(d.row){c.whenRClickToSelect&&b.select(d.data);if(b.hasBind("contextmenu"))return b.trigger("contextmenu",[{data:d.data,rowindex:d.data.__index,row:d.row},a])}else if(d.hcell){if(!c.allowHideColumn)return!0;var e=$(d.hcell).attr("columnindex");if(e==undefined)return!0;var f=a.pageX-b.body.offset().left+parseInt(b.body[0].scrollLeft);e==b.columns.length-1&&(f-=50),b.popup.css({left:f,top:b.gridheader.height()+1}),b.popup.toggle();return!1}},_onDblClick:function(a){var b=this,c=this.options,d=b._getSrcElementByEvent(a);d.row&&b.trigger("dblClickRow",[d.data,d.data.__id,d.row])},_onClick:function(a){var b=a.target||a.srcElement,c=this,d=this.options,e=c._getSrcElementByEvent(a);if(e.out)c.editor.editing&&!$.ligerui.win.masking&&c.endEdit(),d.allowHideColumn&&c.popup.hide();else{if(e.indetail||e.editing)return;c.editor.editing&&c.endEdit(),d.allowHideColumn&&(e.popup||c.popup.hide());if(e.checkboxall){var f=$(e.hrow),g=f.hasClass("l-checked");if(c.trigger("beforeCheckAllRow",[!g,c.element])==!1)return!1;g?f.removeClass("l-checked"):f.addClass("l-checked"),c.selected=[];for(var h in c.records)g?c.unselect(c.records[h]):c.select(c.records[h]);c.trigger("checkAllRow",[!g,c.element])}else if(e.hcelltext){var i=$(e.hcelltext).parent().parent();if(!d.enabledSort||!e.column)return;if(e.column.isSort==!1)return;if(d.url&&c.isDataChanged&&!confirm(d.isContinueByDataChanged))return;var j=$(".l-grid-hd-cell-sort:first",i),k=e.column.name;if(!k)return;j.length>0?j.hasClass("l-grid-hd-cell-sort-asc")?(j.removeClass("l-grid-hd-cell-sort-asc").addClass("l-grid-hd-cell-sort-desc"),i.removeClass("l-grid-hd-cell-asc").addClass("l-grid-hd-cell-desc"),c.changeSort(k,"desc")):j.hasClass("l-grid-hd-cell-sort-desc")&&(j.removeClass("l-grid-hd-cell-sort-desc").addClass("l-grid-hd-cell-sort-asc"),i.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),c.changeSort(k,"asc")):(i.removeClass("l-grid-hd-cell-desc").addClass("l-grid-hd-cell-asc"),$(e.hcelltext).after("<span class='l-grid-hd-cell-sort l-grid-hd-cell-sort-asc'>&nbsp;&nbsp;</span>"),c.changeSort(k,"asc")),$(".l-grid-hd-cell-sort",c.gridheader).add($(".l-grid-hd-cell-sort",c.f.gridheader)).not($(".l-grid-hd-cell-sort:first",i)).remove()}else if(e.detailbtn&&d.detail){var l=e.data,f=$([c.getRowObj(l,!1)]);c.enabledFrozen()&&(f=f.add(c.getRowObj(l,!0)));var h=l.__id;if($(e.detailbtn).hasClass("l-open"))d.detail.onCollapse&&d.detail.onCollapse(l,$(".l-grid-detailpanel-inner:first",m)[0]),f.next("tr.l-grid-detailpanel").hide(),$(e.detailbtn).removeClass("l-open");else{var m=f.next("tr.l-grid-detailpanel");if(m.length>0){m.show(),d.detail.onExtend&&d.detail.onExtend(l,$(".l-grid-detailpanel-inner:first",m)[0]),$(e.detailbtn).addClass("l-open"),c.trigger("SysGridHeightChanged");return}$(e.detailbtn).addClass("l-open");var n=0;for(var o=0;o<c.columns.length;o++)c.columns[o].frozen&&n++;var p=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>"),q=$("<tr class='l-grid-detailpanel'><td><div class='l-grid-detailpanel-inner' style='display:none'></div></td></tr>");p.attr("id",c.id+"|detail|"+h),c.detailrows=c.detailrows||[],c.detailrows.push(p[0]),c.detailrows.push(q[0]);var r=$("div:first",p);r.parent().attr("colSpan",c.columns.length-n),f.eq(0).after(p),n>0&&(q.find("td:first").attr("colSpan",n),f.eq(1).after(q)),d.detail.onShowDetail?(d.detail.onShowDetail(l,r[0],function(){c.trigger("SysGridHeightChanged")}),$("div:first",q).add(r).show().height(d.detail.height||d.detailHeight)):d.detail.render&&(r.append(d.detail.render()),r.show()),c.trigger("SysGridHeightChanged")}}else if(e.groupbtn){var s=$(e.grouprow),t=!0;$(e.groupbtn).hasClass("l-grid-group-togglebtn-close")?($(e.groupbtn).removeClass("l-grid-group-togglebtn-close"),s.hasClass("l-grid-grouprow-last")&&$("td:first",s).width("auto")):(t=!1,$(e.groupbtn).addClass("l-grid-group-togglebtn-close"),s.hasClass("l-grid-grouprow-last")&&$("td:first",s).width(c.gridtablewidth));var u=s.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel");for(;;){if(u.length==0)break;t?(u.show(),u.hasClass("l-grid-detailpanel")&&!u.prev().find("td.l-grid-row-cell-detail:first span.l-grid-row-cell-detailbtn:first").hasClass("l-open")&&u.hide()):u.hide(),u=u.next(".l-grid-row,.l-grid-totalsummary-group,.l-grid-detailpanel")}c.trigger("SysGridHeightChanged")}else if(e.treelink)c.toggle(e.data);else if(e.row&&c.enabledCheckbox()){var v=d.selectRowButtonOnly?!0:!1;d.enabledEdit&&(v=!0);if(e.checkbox||!v){var f=$(e.row),g=f.hasClass("l-selected");if(c.trigger("beforeCheckRow",[!g,e.data,e.data.__id,e.row])==!1)return!1;var w=g?"unselect":"select";c[w](e.data);if(d.tree&&d.autoCheckChildren){var x=c.getChildren(e.data,!0);for(var o=0,y=x.length;o<y;o++)c[w](x[o])}c.trigger("checkRow",[!g,e.data,e.data.__id,e.row])}!e.checkbox&&e.cell&&d.enabledEdit&&d.clickToEdit&&c._applyEditor(e.cell)}else if(e.row&&!c.enabledCheckbox()){e.cell&&d.enabledEdit&&d.clickToEdit&&c._applyEditor(e.cell);if($(e.row).hasClass("l-selected")){if(!d.allowUnSelectRow){$(e.row).addClass("l-selected-again");return}c.unselect(e.data)}else c.select(e.data)}else if(e.toolbar)if(e.first){if(c.trigger("toFirst",[c.element])==!1)return!1;c.changePage("first")}else if(e.prev){if(c.trigger("toPrev",[c.element])==!1)return!1;c.changePage("prev")}else if(e.next){if(c.trigger("toNext",[c.element])==!1)return!1;c.changePage("next")}else if(e.last){if(c.trigger("toLast",[c.element])==!1)return!1;c.changePage("last")}else if(e.load){if($("span",e.load).hasClass("l-disabled"))return!1;if(c.trigger("reload",[c.element])==!1)return!1;if(d.url&&c.isDataChanged&&!confirm(d.isContinueByDataChanged))return!1;c.loadData(d.where)}}},select:function(a){var b=this,c=this.options,d=b.getRow(a),e=d.__id,f=b.getRowObj(e),g=b.getRowObj(e,!0);if(!b.enabledCheckbox()&&!b.ctrlKey){for(var h in b.selected){var i=b.selected[h];i.__id in b.records&&($(b.getRowObj(i)).removeClass("l-selected l-selected-again"),b.enabledFrozen()&&$(b.getRowObj(i,!0)).removeClass("l-selected l-selected-again"))}b.selected=[]}f&&$(f).addClass("l-selected"),g&&$(g).addClass("l-selected"),b.selected[b.selected.length]=d,b.trigger("selectRow",[d,e,f])},unselect:function(a){var b=this,c=this.options,d=b.getRow(a),e=d.__id,f=b.getRowObj(e),g=b.getRowObj(e,!0);$(f).removeClass("l-selected l-selected-again"),b.enabledFrozen()&&$(g).removeClass("l-selected l-selected-again"),b._removeSelected(d),b.trigger("unSelectRow",[d,e,f])},isSelected:function(a){var b=this,c=this.options,d=b.getRow(a);for(var e in b.selected)if(b.selected[e]==d)return!0;return!1},_onResize:function(){var a=this,b=this.options;if(b.height&&b.height!="auto"){var c=$(window).height(),d=0,e=null;if(typeof b.height=="string"&&b.height.indexOf("%")>0){var f=a.grid.parent();b.InWindow?(e=c,e-=parseInt($("body").css("paddingTop")),e-=parseInt($("body").css("paddingBottom"))):e=f.height(),d=e*parseFloat(b.height)*.01;if(b.InWindow||f[0].tagName.toLowerCase()=="body")d-=a.grid.offset().top-parseInt($("body").css("paddingTop"))}else d=parseInt(b.height);d+=b.heightDiff,a.windowHeight=c,a._setHeight(d)}if(a.enabledFrozen()){var g=a.gridview1.width(),h=a.gridview.width();a.gridview2.css({width:h-g})}a.trigger("SysGridHeightChanged")}}),$.ligerui.controls.Grid.prototype.enabledTotal=$.ligerui.controls.Grid.prototype.isTotalSummary,$.ligerui.controls.Grid.prototype.add=$.ligerui.controls.Grid.prototype.addRow,$.ligerui.controls.Grid.prototype.update=$.ligerui.controls.Grid.prototype.updateRow,$.ligerui.controls.Grid.prototype.append=$.ligerui.controls.Grid.prototype.appendRow,$.ligerui.controls.Grid.prototype.getSelected=$.ligerui.controls.Grid.prototype.getSelectedRow,$.ligerui.controls.Grid.prototype.getSelecteds=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRows=$.ligerui.controls.Grid.prototype.getSelectedRows,$.ligerui.controls.Grid.prototype.getCheckedRowObjs=$.ligerui.controls.Grid.prototype.getSelectedRowObjs,$.ligerui.controls.Grid.prototype.setOptions=$.ligerui.controls.Grid.prototype.set})(jQuery)